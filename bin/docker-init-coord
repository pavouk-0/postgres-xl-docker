#!/bin/bash -eu

initdb \
    -D "${PGDATA}" \
    --nodename="${PG_NODE}"

nets=($(ip -o -f inet addr show | awk '/scope global/ {print $4}' |
    sort -V | xargs))

echo "pg_hba: adding host trust ${nets[0]}"

echo "host	all	all	${nets[0]}	trust #added for postgresxl datanodes" >> \
    "${PGDATA}/pg_hba.conf"

echo "pg_hba: adding host md5 ${nets[1]}"

echo "host	all	all	${nets[1]}	md5 #added for postgresxl coordinators" >> \
    "${PGDATA}/pg_hba.conf"
